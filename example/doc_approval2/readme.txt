ภาพรวมของสถาปัตยกรรม (System Architecture)
ระบบนี้ประกอบด้วย 3 ส่วนหลัก:
1. ฐานข้อมูล (Database): หัวใจของระบบ ใช้เก็บข้อมูลเอกสาร สถานะ ผู้ที่ต้องอนุมัติคนปัจจุบัน และลำดับการอนุมัติที่กำหนดไว้ล่วงหน้า

2. ฝั่งเซิร์ฟเวอร์ (Backend - PHP):
connection_class.php: จัดการการเชื่อมต่อฐานข้อมูล (ที่คุณให้มา)
document_class.php: Class หลักที่จัดการตรรกะทั้งหมดของเอกสาร เช่น สร้าง, แก้ไข, ส่งอนุมัติ, อนุมัติ (Approve), และปฏิเสธ (Reject)
api_handler.php(ตัวกลางรับ-ส่งข้อมูล): เป็น API Endpoint ที่รับคำสั่งจาก JavaScript ผ่าน AJAX เพื่อเรียกใช้เมธอดต่างๆ ใน document_class.php

3. ฝั่งไคลเอนต์ (Frontend - HTML/JS):
document_view.php: หน้าเว็บสำหรับแสดงผลข้อมูลเอกสารและปุ่มดำเนินการต่างๆ
app.js: ไฟล์ JavaScript ที่ใช้ jQuery $.ajax() เพื่อสื่อสารกับ api_handler.php โดยไม่ต้องโหลดหน้าเว็บใหม่ทั้งหมด

วิธีการทดสอบและใช้งาน (Step-by-Step)
1. ตั้งค่าฐานข้อมูล: สร้างฐานข้อมูลและตารางตาม SQL ที่ให้ไว้ และใส่ข้อมูลตัวอย่าง (users, document_types, workflow_steps)

2. วางไฟล์: วางไฟล์ PHP และ JS ทั้งหมดในไดเรกทอรีเดียวกันบนเว็บเซิร์ฟเวอร์ของคุณ

3. เริ่มต้นสร้างเอกสาร A:

เปิดเบราว์เซอร์ไปที่ document_view.php?user_id=1 (จำลองว่าเป็น admin)

คลิกที่ลิงก์ "Create New Document A"

ระบบจะสร้างเอกสารใหม่และพาคุณไปยังหน้าของเอกสารนั้น (เช่น document_view.php?doc_id=1&user_id=1)

4. Admin แก้ไขและส่ง (A2, A3):

คุณจะเห็นเอกสารในสถานะ "Draft" และมีปุ่ม "Save Changes" กับ "Submit for Approval"

แก้ไข Title และ Content แล้วกด "Save Changes" เพื่อทดสอบการอัปเดต

เมื่อพร้อมแล้ว กด "Submit for Approval"

หน้าเว็บจะรีโหลด สถานะจะเปลี่ยนเป็น "Pending" และปุ่มต่างๆ จะหายไป เพราะตอนนี้ admin ไม่ใช่ผู้ดำเนินการ

5. ผู้อนุมัติคนที่ 1 (A4):

เปลี่ยน URL เป็น document_view.php?doc_id=1&user_id=2 (จำลองว่าเป็น approver1)

คุณจะเห็นปุ่ม "Approve" และ "Reject"

ทดลอง Reject: กด "Reject" หน้าจะรีโหลด สถานะเอกสารจะกลายเป็น "Rejected"

กลับไปที่ Admin: เปลี่ยน URL กลับไปเป็น ...user_id=1 คุณจะเห็นปุ่ม "Save" และ "Submit" อีกครั้ง ให้กด Submit ใหม่

ทดลอง Approve: กลับไปที่ ...user_id=2 แล้วกด "Approve"

6. ผู้อนุมัติคนที่ 2 และคนสุดท้าย (A5, A6):

หน้าเว็บจะรีโหลด ตอนนี้เอกสารรอการอนุมัติจาก user_id=3 (approver2)

เปลี่ยน URL เป็น ...user_id=3 แล้วกด "Approve"

หน้าเว็บจะรีโหลดอีกครั้ง ตอนนี้รอการอนุมัติจาก user_id=4 (final_approver_A)

เปลี่ยน URL เป็น ...user_id=4 แล้วกด "Approve"

7. เอกสาร A สำเร็จ และเอกสาร B ถูกสร้าง:

เมื่อ final_approver_A กดอนุมัติ สถานะเอกสาร A จะเป็น "Completed"

ที่สำคัญคือ เอกสาร B จะถูกสร้างขึ้นโดยอัตโนมัติในฐานข้อมูล โดยมีสถานะเป็น "Pending" และรอการอนุมัติจากผู้อนุมัติคนแรกของ Workflow B (user_id=5)

8. ตรวจสอบและอนุมัติเอกสาร B:

เปิดเอกสาร B โดยตรงผ่าน URL เช่น document_view.php?doc_id=2&user_id=5

คุณจะเห็นว่ากระบวนการอนุมัติของเอกสาร B เริ่มต้นทันที และสามารถดำเนินต่อไปตามลำดับชั้นที่กำหนดไว้ในตาราง workflow_steps ได้เลย




