คำอธิบายโค้ด:
1. config.php: เป็นไฟล์ที่เก็บข้อมูลการเชื่อมต่อกับฐานข้อมูล MySQL ของคุณ คุณจะต้องแก้ไขส่วน $db_name, $db_user, และ $db_pass ให้ตรงกับการตั้งค่าฐานข้อมูลของคุณ
2. index.php: เป็นหน้าสำหรับสร้างงานใหม่
        - มีการตรวจสอบว่าผู้ใช้ได้เข้าสู่ระบบแล้วหรือไม่ (ในตัวอย่างนี้เรากำหนด $_SESSION['user_id'] เองเพื่อความง่ายในการทดลอง)
        - เมื่อมีการส่งฟอร์ม จะดึงข้อมูลจากฟอร์ม (title, description, work_type)
        - ใช้ PDO ในการเพิ่มข้อมูลลงในตาราง work_items
        - หลังจากเพิ่มงานแล้ว จะทำการดึงข้อมูลผู้อนุมัติที่เกี่ยวข้องกับ work_type นั้นๆ จากตาราง workflows และ workflow_steps
        - จากนั้นจะเพิ่มรายการเริ่มต้นสำหรับงานนี้ในตาราง work_item_approvals โดยมีสถานะเป็น 'Pending' (รออนุมัติ)
3. approval_list.php: เป็นหน้าสำหรับแสดงรายการงานที่รอการอนุมัติสำหรับผู้ใช้ที่ล็อกอิน (ในตัวอย่างนี้เรากำหนด $_SESSION['user_id'] เป็น approver1 เพื่อทดสอบ)
        - ใช้ PDO ในการดึงข้อมูลจากตาราง work_item_approvals โดยกรองเอางานที่ approver_id ตรงกับผู้ใช้ปัจจุบัน และมีสถานะเป็น 'Pending' รวมถึง current_approval_level ในตาราง work_items ตรงกับ approval_level ใน work_item_approvals
        - แสดงรายการงานที่รออนุมัติเป็นลิงก์ไปยังหน้า view_work_item.php
4. view_work_item.php: เป็นหน้าสำหรับแสดงรายละเอียดของงานที่ต้องการอนุมัติ
        - ตรวจสอบว่ามี id ของงานที่ต้องการดูหรือไม่
        - ใช้ PDO ในการดึงข้อมูลงานจากตาราง work_items และข้อมูลการอนุมัติจาก work_item_approvals สำหรับงานนั้นและผู้ใช้ปัจจุบัน โดยตรวจสอบเงื่อนไขว่ายังอยู่ในขั้นตอนที่ผู้ใช้คนนี้ต้องอนุมัติ
        - เมื่อมีการส่งฟอร์ม (กดปุ่มอนุมัติหรือปฏิเสธ):
            approve
            - จะตรวจสอบว่าเป็นการอนุมัติ ('approve') หรือปฏิเสธ ('reject')
            - อัปเดตสถานะในตาราง work_item_approvals เป็น 'Approved' หรือ 'Rejected' พร้อมบันทึกเวลาและข้อความความคิดเห็น (ถ้ามี)
            - ถ้าเป็นการอนุมัติ จะตรวจสอบว่ามีขั้นตอนการอนุมัติถัดไปหรือไม่ โดยดูจากตาราง workflow_steps
            - ถ้ามีขั้นตอนถัดไป จะอัปเดต current_approval_level ในตาราง work_items
            - ถ้าไม่มีขั้นตอนถัดไป จะอัปเดต status ในตาราง work_items เป็น 'Closed'

            reject
            - ถ้าเป็นการปฏิเสธ จะอัปเดต status ในตาราง work_items เป็น 'Rejected'
            - หา Approval Level ก่อนหน้า: 
                - เราใช้ SQL query เพื่อหา approval_level ที่มีค่ามากที่สุด (MAX) ที่น้อยกว่า (<) approval_level ปัจจุบัน สำหรับ workflow_id เดียวกัน
                - เปรียบเทียบเหมือนเดิมโดยใช้ workflow_id ที่ได้จาก workflow_steps โดยอ้างอิงจาก approver_id และ current_level
            - อัปเดต current_approval_level: หากพบ approval_level ก่อนหน้า (ค่ามากกว่าหรือเท่ากับ 1) เราจะอัปเดตค่า current_approval_level ในตาราง work_items ให้กลับไปที่ระดับก่อนหน้า และเปลี่ยน status ของงานกลับเป็น 'Pending'
            - รีเซ็ตสถานะการอนุมัติของระดับก่อนหน้า: เพื่อให้ผู้อนุมัติคนก่อนหน้าสามารถดำเนินการได้อีกครั้ง เราจะอัปเดตสถานะของ work_item_approvals สำหรับ approval_level ก่อนหน้า ให้กลับเป็น 'Pending', ล้าง approved_at และ approval_comment
            - กรณีไม่พบขั้นตอนก่อนหน้า: หากไม่พบขั้นตอนก่อนหน้า (เช่น ปฏิเสธในขั้นตอนแรก) ระบบจะยังคงตั้งสถานะของงานเป็น 'Rejected'

วิธีการทดลอง:
1. บันทึกโค้ด PHP ทั้ง 3 ไฟล์ (config.php, index.php, approval_list.php, view_work_item.php) ในโฟลเดอร์ที่คุณตั้งค่าไว้สำหรับเว็บเซิร์ฟเวอร์ของคุณ (เช่น htdocs ใน XAMPP)
2. แก้ไขไฟล์ config.php ให้ข้อมูลการเชื่อมต่อฐานข้อมูลถูกต้อง
3. เปิดเบราว์เซอร์ของคุณและเข้าไปที่หน้า index.php เพื่อสร้างงานใหม่ เลือกประเภทงาน เช่น 'เอกสารทั่วไป' แล้วกดส่งงาน
4. เข้าไปที่หน้า approval_list.php (คุณอาจจะต้องเปลี่ยนค่า $_SESSION['user_id'] ในไฟล์นี้เป็น 2 ซึ่งเป็น ID ของ approver1) คุณจะเห็นงานที่คุณสร้างปรากฏอยู่ในรายการ
5. คลิกที่หัวข้องานเพื่อไปยังหน้า view_work_item.php ในฐานะ approver1 คุณจะสามารถอนุมัติหรือปฏิเสธงานได้
6. หากคุณอนุมัติงาน ให้ลองเปลี่ยนค่า $_SESSION['user_id'] ใน approval_list.php และ view_work_item.php เป็น 3 (สำหรับ approver2) แล้วเข้าไปดูอีกครั้ง คุณจะเห็นงานนั้นรอการอนุมัติจาก approver2
7. ทำซ้ำขั้นตอนเพื่อทดสอบการอนุมัติในลำดับถัดไป เมื่อถึงผู้อนุมัติคนสุดท้าย สถานะของงานควรจะเปลี่ยนเป็น 'Closed'